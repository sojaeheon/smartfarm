
services:
    backend:
        build: ./backend
        volumes:
            - ./backend:/app
        container_name: backend
        restart: always
        environment:
            - FLASK_ENV=development
            - TRANSFORMERS_CACHE=/app/.cache/huggingface
            - HF_HOME=/app/cache/huggingface
            # - MONGO_URI=mongodb://mongo:27017/farmi_db
        expose:
            - 6000
        networks:
            - app-network


    frontend:
        build:
            context: .
            dockerfile: frontend/Dockerfile
        volumes:
            - ./frontend:/app
            - /app/node_modules 
        container_name: frontend
        restart: always
        networks:
            - app-network
        depends_on:
            - backend


    nginx:
        image: nginx:latest
        volumes:
            - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
            - ./frontend/dist:/usr/share/nginx/html   
        container_name: nginx
        restart: always
        ports:
            - "80:80"
        depends_on:
            - backend
            - frontend
        networks:
            - app-network
    
#     mongo:
#         image: mongo:latest
#         container_name: mongodb
#         volumes:
#             - mongo-data:/data/db
#         ports:
#             - "27017:27017"  # MongoDB의 기본 포트
#         # environment:
#         #     MONGO_INITDB_ROOT_USERNAME: 사용자명
#         #     MONGO_INITDB_ROOT_PASSWORD: 비밀번호
    
# volumes:
#     mongo-data:


networks:
    app-network:
        driver: bridge
    